#!/bin/sh

# --- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ---
CONFIG_DIR="$(dirname "$(realpath "$0")")/configs"
HUSKY_DIR="../"
LOG_PREFIX="husky-"

LOG_FILE="$(git rev-parse --short HEAD 2>/dev/null || echo "pre-commit")"
CURRENT_LOG=".husky/${LOG_PREFIX}${LOG_FILE}.log"

echo "üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–≤–µ—Ä–æ–∫ –¥–ª—è –∫–æ–º–º–∏—Ç–∞: ${LOG_FILE}" | tee "${CURRENT_LOG}"
npx lint-staged --verbose | tee -a "${CURRENT_LOG}"

# –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∞–π–ª–æ–≤ –ª–æ–≥–æ–≤ (—Å–æ—Ö—Ä–∞–Ω—è–µ–º –ø–æ—Å–ª–µ–¥–Ω–∏–µ 10)
ls -t ${HUSKY_DIR}/${LOG_PREFIX}*.log | tail -n +11 | xargs rm -f --
