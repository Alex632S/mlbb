#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "ðŸŸ¢ Husky: ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ pre-commit Ñ…ÑƒÐºÐ°"
echo "ðŸ• Ð”Ð°Ñ‚Ð°: $(date)"
echo "ðŸ“¦ Ð’ÐµÑ€ÑÐ¸Ñ node: $(node -v)"
echo "ðŸ“¦ Ð’ÐµÑ€ÑÐ¸Ñ npm: $(npm -v)"
echo "ðŸ“¦ Ð’ÐµÑ€ÑÐ¸Ñ yarn: $(yarn -v)"

echo "ðŸ” Ð—Ð°Ð¿ÑƒÑÐº lint-staged..."
npx lint-staged

EXIT_CODE=$?
if [ $EXIT_CODE -ne 0 ]; then
  echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ (ÐºÐ¾Ð´: $EXIT_CODE)"
else
  echo "âœ… Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾"
fi

LOG_FILE="husky.log"

{
  echo "=== ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ: $(date) ==="
  echo "Ð—Ð°Ð¿ÑƒÑÐº lint-staged..."
  npx lint-staged
  echo "Ð¡Ñ‚Ð°Ñ‚ÑƒÑ Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¸Ñ: $?"
  echo "=== ÐšÐ¾Ð½ÐµÑ† Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ ==="
} >> "$LOG_FILE" 2>&1
